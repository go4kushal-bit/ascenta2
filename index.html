<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">

<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ASCENT HUB</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'SF Pro Display',-apple-system,system-ui,sans-serif;min-height:100vh;background:#0a0a0a;color:#fff}
#lock{position:fixed;inset:0;display:flex;align-items:stretch;justify-content:stretch;z-index:10}
.container{background:#0a0a0a;width:100%;height:100%;display:flex;flex-direction:column;color:#fff;position:relative;z-index:2}
.header{background:#111;border-bottom:1px solid #1f1f1f;padding:32px 48px;display:flex;align-items:center;justify-content:space-between}
.logo-section{display:flex;align-items:center;gap:16px}
.logo-box{width:48px;height:48px;background:linear-gradient(135deg,#e11d48,#9333ea);border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:24px;letter-spacing:-1px}
.title-group h1{font-size:28px;font-weight:700;letter-spacing:-0.5px;margin-bottom:2px}
.title-group .version{font-size:12px;color:#666;font-weight:500;text-transform:uppercase;letter-spacing:1px}
.status-badge{padding:6px 14px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:20px;font-size:11px;font-weight:600;color:#888;text-transform:uppercase;letter-spacing:0.5px}
.content{padding:48px;flex:1;overflow-y:auto}
.notice-section{margin-bottom:28px}
.notice-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid #1a1a1a}
.notice-icon{width:20px;height:20px;background:#dc2626;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:13px}
.notice-title{font-size:13px;font-weight:600;color:#999;text-transform:uppercase;letter-spacing:1px}
.notice-text{font-size:13px;line-height:1.7;color:#888;font-weight:400}
.notice-text strong{color:#aaa;font-weight:600}
.form-section{display:grid;grid-template-columns:1fr auto;gap:12px;margin-bottom:14px}
.input-wrapper{position:relative}
.input-wrapper:before{content:'ðŸ”‘';position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:16px;opacity:.5}
input{width:100%;padding:14px 16px 14px 48px;background:#0d0d0d;border:1px solid #1a1a1a;border-radius:6px;color:#fff;font-size:15px;font-family:inherit;transition:border-color .2s}
input:focus{outline:none;border-color:#333}
input::placeholder{color:#444}
button{padding:14px 32px;background:#fff;color:#000;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:background .2s;white-space:nowrap}
button:hover{background:#e5e5e5}
button:disabled{opacity:.5;cursor:not-allowed}
#msg{font-size:13px;color:#666;text-align:left;min-height:20px;margin-top:6px}

.footer{background:#0d0d0d;border-top:1px solid #1a1a1a;padding:20px 48px;display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#555}
.footer-links{display:flex;gap:20px}
.footer-links span{cursor:pointer;transition:color .2s}
.footer-links span:hover{color:#888}

/* Grid overlay */
#lock:before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,.01) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.01) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:1}
#lock:after{content:'';position:absolute;inset:0;background:radial-gradient(circle at center,transparent 0%,rgba(0,0,0,.6) 100%);pointer-events:none;z-index:1}

/* HUB */
#hub{display:none}
.hub-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:18px}
a.card{display:block;text-decoration:none;color:inherit;background:#121a2a;border:1px solid #1e2a44;border-radius:16px;padding:16px;transition:transform .12s ease,border-color .12s ease}
a.card:hover{transform:translateY(-2px);border-color:#3c58ff}
.tag{display:inline-block;font-size:12px;color:#b9c6ff;background:#1a2350;border-radius:999px;padding:6px 10px;margin-bottom:10px}
.card-title{font-size:18px;margin:6px 0 4px}
.card-desc{margin:0;color:#aab6d6;font-size:14px;line-height:1.35}

@media(max-width:768px){
  .header,.content,.footer{padding:24px}
  .form-section{grid-template-columns:1fr;gap:10px}
  button{width:100%}
}
</style>
</head>

<body>

<div id="lock">
  <div class="container">
    <div class="header">
      <div class="logo-section">
        <div class="logo-box">AH</div>
        <div class="title-group">
          <h1>ASCENT HUB</h1>
          <div class="version">Authentication Required</div>
        </div>
      </div>
      <div class="status-badge">â¬¤ Secure</div>
    </div>

    <div class="content">
      <div class="notice-section">
        <div class="notice-header">
          <div class="notice-icon">!</div>
          <div class="notice-title">Access</div>
        </div>
        <div class="notice-text">
          Enter a valid access key to view the game hub.
        </div>
      </div>

      <div class="form-section">
        <div class="input-wrapper">
          <input id="keyInput" placeholder="Enter access key" autocomplete="off">
        </div>
        <button id="unlockBtn">Authenticate</button>
      </div>

      <div id="msg"></div>
    </div>

    <div class="footer">
      <div>Â© 2025 KAS. All rights reserved.</div>
      <div class="footer-links">
        <span>Terms</span>
        <span>Privacy</span>
        <span>Support</span>
      </div>
    </div>
  </div>
</div>

<!-- HUB CONTENT (hidden until authenticated) -->
<div id="hub">
  <div class="header">
    <div class="logo-section">
      <div class="logo-box">AH</div>
      <div class="title-group">
        <h1>ASCENT HUB</h1>
        <div class="version">Select a game</div>
      </div>
    </div>
    <div class="status-badge">â¬¤ Unlocked</div>
  </div>

  <div class="content">
    <div class="hub-grid">
      <!-- Update/add cards as you add folders -->
      <a class="card" href="polytrack/">
        <div class="tag">Racing</div>
        <div class="card-title">PolyTrack</div>
        <p class="card-desc">Tracks + time trials</p>
      </a>

      <!-- Example for later:
      <a class="card" href="ascent2/">
        <div class="tag">Arcade</div>
        <div class="card-title">Ascent 2</div>
        <p class="card-desc">Coming soon</p>
      </a>
      -->
    </div>
  </div>

  <div class="footer">
    <div>Unlocked for this session.</div>
    <div class="footer-links">
      <span onclick="lockAgain()">Lock</span>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-xmCzHc0_sXOxOyAHppw1brgX0CX8dfU",
  authDomain: "hwid-lock.firebaseapp.com",
  projectId: "hwid-lock",
  storageBucket: "hwid-lock.firebasestorage.app",
  messagingSenderId: "151533882029",
  appId: "1:151533882029:web:561773ea8e9108ed99d424"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const msg=document.getElementById("msg");
const input=document.getElementById("keyInput");
const btn=document.getElementById("unlockBtn");

// Keep your â€œsession unlockedâ€ behavior
if(sessionStorage.getItem("unlocked")==="1"){
  showHub();
}

btn.onclick=tryUnlock;
input.addEventListener("keydown",e=>{if(e.key==="Enter")tryUnlock();});

async function tryUnlock(){
  const key=input.value.trim();
  if(!key)return;

  msg.textContent="Verifying...";
  msg.style.color="#666";
  btn.disabled=true;

  // NOTE: This â€œhwidâ€ is not real security; kept to match your existing logic.
  const hwid = btoa(navigator.userAgent+screen.width+screen.height+navigator.language);

  // ðŸ‘‘ ADMIN KEY
  const adminSnap=await getDoc(doc(db,"admin_keys",key));
  if(adminSnap.exists()){
    msg.style.color="#4ade80";
    msg.textContent="Access granted.";
    setTimeout(()=>unlockSession(),400);
    return;
  }

  // ðŸ”‘ UNUSED KEY
  const keyRef=doc(db,"keys",key);
  const keySnap=await getDoc(keyRef);
  if(keySnap.exists()){
    await setDoc(doc(db,"used_keys",key),{hwid,time:Date.now()});
    await deleteDoc(keyRef);
    unlockSession();
    return;
  }

  // ðŸ”’ USED KEY
  const usedSnap=await getDoc(doc(db,"used_keys",key));
  if(usedSnap.exists()){
    if(usedSnap.data().hwid===hwid){
      unlockSession();
    }else{
      msg.style.color="#dc2626";
      msg.textContent="Key locked to another device";
      btn.disabled=false;
    }
    return;
  }

  msg.style.color="#dc2626";
  msg.textContent="Invalid key";
  btn.disabled=false;
}

function unlockSession(){
  sessionStorage.setItem("unlocked","1");
  showHub();
}

function showHub(){
  // Hide lock screen
  const lock=document.getElementById("lock");
  if(lock){ lock.remove(); }
  // Show hub
  document.getElementById("hub").style.display="block";
}

window.lockAgain = function(){
  sessionStorage.removeItem("unlocked");
  location.reload();
}
</script>

</body>
</html>

