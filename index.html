<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">

<link rel="preload" href="forced_square.woff2" as="font" type="font/woff2" crossorigin="anonymous"/>
<link rel="preload" href="images/logo.svg" as="image" type="image/svg+xml"/>

<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ASCENT 2</title>

<style>
body{
  margin:0;background:radial-gradient(circle at top,#111,#000);
  color:white;font-family:system-ui;overflow:hidden
}
#lock{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999
}
.card{
  width:92%;max-width:420px;background:#0d0d0d;padding:26px;border-radius:18px;
  text-align:center;box-shadow:0 0 60px rgba(0,0,0,.8)
}
h1{margin:0 0 6px;letter-spacing:3px}
.red{color:#ff4d4d}
p{font-size:13px;line-height:1.5;opacity:.85}

input{
  width:100%;padding:14px;border-radius:12px;border:none;
  font-size:16px;margin-top:12px;background:#111;color:white
}
button{
  width:100%;padding:14px;border-radius:12px;border:none;
  background:linear-gradient(135deg,#6366f1,#4338ca);
  color:white;font-size:16px;margin-top:12px
}
#msg{min-height:22px;margin-top:8px}

/* car animation */
.road{position:relative;margin:14px 0;height:4px;background:#222;overflow:hidden}
.car{
  position:absolute;top:-18px;left:-90px;width:80px;height:36px;
  background:#ff3b3b;border-radius:8px;animation:drive 3s linear infinite
}
.car:before,.car:after{
  content:"";position:absolute;bottom:-10px;width:16px;height:16px;
  background:#000;border-radius:50%
}
.car:before{left:10px}
.car:after{right:10px}
@keyframes drive{from{left:-100px}to{left:110%}}
</style>
</head>

<body>

<!-- LOCK + DISCLAIMER -->
<div id="lock">
  <div class="card">
    <h1>ASCENT 2</h1>

    <div class="road"><div class="car"></div></div>

    <p class="red">
      We (KAS) remain anonymous and retain full ownership and rights to this website and all systems.
      Any attempt to bypass, tamper, or exploit this service will be detected and may result in permanent
      bans or further repercussions. By continuing, you are granted a limited license to use this website.
    </p>

    <input id="keyInput" placeholder="Enter Access Key">
    <button id="unlockBtn">UNLOCK</button>
    <p id="msg"></p>
  </div>
</div>

<!-- GAME HUB -->
<canvas id="screen"></canvas>
<div id="ui"></div>
<div id="transition-layer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-xmCzHc0_sXOxOyAHppw1brgX0CX8dfU",
  authDomain: "hwid-lock.firebaseapp.com",
  projectId: "hwid-lock",
  storageBucket: "hwid-lock.firebasestorage.app",
  messagingSenderId: "151533882029",
  appId: "1:151533882029:web:561773ea8e9108ed99d424"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const hwid = btoa(navigator.userAgent+screen.width+screen.height+navigator.language);

const msg=document.getElementById("msg");
const input=document.getElementById("keyInput");

document.getElementById("unlockBtn").onclick=tryUnlock;
input.addEventListener("keydown",e=>{if(e.key==="Enter")tryUnlock();});

async function tryUnlock(){
  const key=input.value.trim();
  if(!key)return;

  msg.textContent="Checking...";

  // üëë ADMIN KEY
  const adminSnap=await getDoc(doc(db,"admin_keys",key));
  if(adminSnap.exists()){
    msg.style.color="#4ade80";
    msg.textContent="WE MAKIN IT OUT FR üî•";
    setTimeout(unlock,600);
    return;
  }

  // üîë UNUSED KEY
  const keyRef=doc(db,"keys",key);
  const keySnap=await getDoc(keyRef);
  if(keySnap.exists()){
    await setDoc(doc(db,"used_keys",key),{hwid,time:Date.now()});
    await deleteDoc(keyRef);
    unlock();
    return;
  }

  // üîí USED KEY
  const usedSnap=await getDoc(doc(db,"used_keys",key));
  if(usedSnap.exists()){
    if(usedSnap.data().hwid===hwid){
      unlock();
    }else{
      msg.style.color="#f87171";
      msg.textContent="üòà Nice try haha, this key is locked to another device.";
    }
    return;
  }

  msg.style.color="#f87171";
  msg.textContent="‚ùå Invalid key.";
}

function unlock(){
  document.getElementById("lock").remove();
  load("error_screen.bundle.js");
  load("main.bundle.js");
}

function load(s){
  const e=document.createElement("script");
  e.src=s;e.defer=true;document.head.appendChild(e);
}
</script>

</body>
</html>
